name: clang-tidy check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  setup-and-tidy:
    runs-on: ubuntu-24.04

    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/install-gtest
      with:
        shell-name: bash

    # generate compile_commands.json
    - run: | 
        mkdir -p build
        cmake -B build -S . -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

    - uses: ./.github/actions/config-cmake
      with: 
        cpp-compiler: g++
        c-compiler: gcc
        build-type: Debug
    - uses: ./.github/actions/run-clang-tidy
      with: 
        shell-name: bash